<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="CACHE-CONTROL" content="NO-CACHE" />
    <!-- Scripts -->
    <script type="text/javascript" src="Scripts/roomReader.js"></script>
    <script type="text/javascript" src="Scripts/playerInputParser.js"></script>
    <script
      type="text/javascript"
      src="Scripts/playerInputFunctions.js"
    ></script>
    <!-- <script type="text/javascript" src="Scripts/sidebar.js"></script> -->

    <!-- Style Sheets -->
    <!-- <link rel="stylesheet" type="text/css" href="Style/sidebar.css"> -->
    <link rel="stylesheet" type="text/css" href="Style/style.css" />
    <link rel="stylesheet" type="text/css" href="Style/gameTextStyle.css" />
    <link rel="stylesheet" type="text/css" href="Style/collapsibleNotes.css" />
  </head>

  <body>
    <!-- Main Body -->
    <div id="main">
      <!-- Notes box -->
      <div id="notesBox">
        <button type="button" class="collapsible">Notes</button>
        <div id="notesBoxContent" class="content">
          <textarea id="notesBoxtextarea" name="notesBoxtextarea">
        An excellent place to keep notes while you play, does not save between sessions (yet)</textarea
          >
        </div>
      </div>
      <div id="gameText"></div>
      <!-- This is the players input box, the main way for them to interact -->
      <div id="inputContianer">
        <div id="inputBox" class="consoleEntry">
          <div>
            <!-- Display Text -->
            <span id="consoleID">[home ~/]> </span>
            <!-- Input Box -->
            <input type="text" spellcheck="false" id="roomNumber" autofocus />
            <!-- Go Box -->
            <input
              id="inputTriggerButton"
              type="button"
              value="Go"
              onclick="readPlayerInput(document.getElementById('roomNumber').value);
                  inputLog.push(document.getElementById('roomNumber').value);
                  document.getElementById('roomNumber').value=''"
              hidden
            />
          </div>
        </div>
      </div>
    </div>
    <script>
      //Collapsable Notes
      var coll = document.getElementsByClassName("collapsible");
      var i, w, h;
      var notesBoxtextarea = document.getElementById("notesBoxtextarea");
      var notesBoxContent = document.getElementById("notesBoxContent");

      for (i = 0; i < coll.length; i++) {
        coll[i].addEventListener("click", function () {
          this.classList.toggle("active");
          var content = document.getElementById("notesBoxContent");
          if (content.style.maxHeight) {
            content.style.maxHeight = null;
            content.style.maxWidth = null;
            // content.style.height = null;
            // content.style.width = null;
            content.style.border = "none";
            // content.style.resize = "none";
          } else {
            content.style.maxHeight = content.scrollHeight + "px";
            content.style.border = "2px solid #008000";
            // content.style.resize = "both";
          }
        });
      }

      function notesBoxtestareresize() {
        //Cap size based on Window
        if (notesBoxContent.style.maxHeight) {
          console.log("Trigger resize event");
          w = Math.floor(window.innerWidth / 2);
          h = Math.floor(window.innerHeight * 0.8);
          notesBoxContent.style.maxHeight = h + "px";
          notesBoxContent.style.maxWidth = w + "px";
        }
      }

      notesBoxtestareresize();

      const resizeObserver = new ResizeObserver(notesBoxtestareresize).observe(
        notesBoxtextarea
      );

      //Listener Events for page
      //Tracking vars
      var ctrlDepressed = false;

      //Global Listener Events

      onkeydown = (event) => {
        ctrlDepressed = event.ctrlKey;
        var activeElement = document.activeElement;

        //When the user starts typing, autofocus on the input box, will not trigger if the user is holding the ctrl key
        if (
          !ctrlDepressed &&
          activeElement != document.getElementById("notesBoxtextarea")
        ) {
          document.getElementById("roomNumber").focus();
        }
      };

      onkeyup = (event) => {
        ctrlDepressed = event.ctrlKey;
      };

      //Listener events for input box
      var input = document.getElementById("roomNumber");
      var inputLog = [""];
      var inputLogIndex = 0;
      input.addEventListener("keyup", function (event) {
        if (event.key == "Enter") {
          event.preventDefault();
          document.getElementById("inputTriggerButton").click();
          inputLogIndex = 0;
        } else if (event.key == "ArrowUp") {
          inputLogIndex += 1;
          inputLogIndex = Math.min(inputLog.length, inputLogIndex);
          // console.log(inputLogIndex);
          accessTerminalLog(0 - inputLogIndex);
        } else if (event.key == "ArrowDown") {
          inputLogIndex -= 1;
          inputLogIndex = Math.max(0, inputLogIndex);
          // console.log(inputLogIndex);
          accessTerminalLog(0 - inputLogIndex);
        }
      });

      //Display code for console on load
      var welcomeArray = [
        false,
        "Welcome to COYA_helper, type 'help' for options",
      ];
      renderConsoleEntry(welcomeArray);

      loadBook("load Assets/Fighting Fantasy Books/FF02_Citadel_of_Chaos.json");
    </script>
  </body>
</html>
